<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Video</title>
    <link rel="stylesheet" href="/stylesheets/live-player.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <section>
        <div class="container">
            <div class="player">
                <div class="local-video">
                    <video id="localVideo" autoplay muted playsinline></video>
                </div>
                <div class="remote-video">
                    <label class="comment-btn" for="commentsToggle" id="icon">
                        <i class="fas fa-comment comment-i"></i> 
                    </label>
                    <div id="remoteVideos"></div> <!-- Container for multiple remote videos -->
                    <% if(isCreator || isOpponent){ %>
                        <button class="start-stream-btn">Start Stream</button>
                        <button class="end-call-btn">End Call</button>
                    <% } %>
                </div>
            </div>
            <% if(isViewer){ %>
            <div class="about-video">
                <p class="title"><%= Live.title %></p>
                <div class="description">
                    <p><%= Live.description %></p>
                </div>
            <% } %>
            </div>
            <% if(isViewer){ %>
            <div class="video-user-info">
                <img src="/images/Default.png" alt="Default Avatar" class="user-avatar">
                <div class="creator-details">
                    <a href="/creator/creator" class="creator-name">
                        Creator Username
                    </a>
                    <p class="followers-count"><%= follower %> Followers</p>
                </div>
            <% } %>
                <% if(isViewer){ %>
                <% if (isFollowing) { %>
                    <button class="unfollow" data-creator-id="<%= Live.creator[0]._id %>" id="follow-btn">Unfollow</button>
                <% } else { %>
                    <button class="follow" data-creator-id="<%= Live.creator[0]._id %>" id="follow-btn">Follow</button>
                <% } %>
                <% } %>
            </div> 
        <% if(isViewer){ %>
        <input type="checkbox" id="commentsToggle" class="comments-toggle" hidden>
        <div class="panel">
            <div id="buttons">
                <div>Comments</div>
                <div>Questions</div>
            </div>
            <div class="comments">
                <div class="comment-input">
                    <input type="text" placeholder="Add a comment" id="commentInputComments">
                    <button id="commentButtonComments">âž¤</button>
                </div>
                <div class="allsinglecomment">
                <% comments.forEach(function(comment) { %>
                <div class="comment-list" id="comment-list">
                    <% if (comment.userId && comment.userId.profile) { %>
                        <img src="data:image/jpeg;base64,<%= comment.userId.profile.toString('base64') %>" 
                        alt="" class="comment-image">
                    <% } else { %>
                        <img src="/images/default.png" alt="Default Profile" class="comment-image">
                    <% } %>
                    <p><strong class="strong"><%= comment.userId.username %>:</strong> <%= comment.text %></p>
                </div>
                <% }) %>
            </div>
            </div> 
            <div id="questions">
                <div class="comment-list">
                    <li class="single-question">
                        Me hu Daro Mat Sachin, Tum Bus Mehnat Karte Raho aur mere Priyata ka nam lete Raho, Aur Jo Tum Kar Rahe Ho Wo Karte Raho
                    </li>
                </div>
                <div class="comment-input">
                    <input type="text" placeholder="Ask a question" id="commentInputQuestions">
                    <button id="commentButtonQuestions">Submit</button>
                </div>
            </div>
        </div>
        <% } %>
    </div>
</div>
    </section>
    <script src="/javascript/socket.io.js"></script>
    <script>
       const socket = io();
       const postBtn = document.querySelector("#commentButtonComments");
       const commentInput = document.querySelector("#commentInputComments");
       const commentSection = document.querySelector(".allsinglecomment");
       const liveId = "<%= Live._id %>";
       console.log(liveId);

       postBtn.addEventListener("click", () => {
        const commentText = commentInput.value.trim(); 
        if (commentText) {
            const commentData = {
                text: commentText,
                userId: "<%= user._id %>",
                liveId: liveId
            };
            console.log(commentData);
            socket.emit("livenewComment", commentData);
            commentInput.value = ""; // Clear input
        }
       });

       socket.on("liveaddComment", (data) => {
    const commentElement = document.createElement("div");
    commentElement.classList.add("single-comment");
    commentElement.innerHTML = `
        <img src="${data.image}" alt="" class="comment-image">
        <p><strong class="strong">${data.username}:</strong> ${data.text}</p>
    `;
    commentSection.prepend(commentElement);

    // Update comment count
    commentCount.textContent = parseInt(commentCount.textContent) + 1;
});


        
    </script>
     <script>
        document.addEventListener("DOMContentLoaded", function () {
            const commentsSection = document.querySelector(".comments");
            const questionsSection = document.querySelector("#questions");
            const commentsButton = document.querySelector("#buttons div:nth-child(1)");
            const questionsButton = document.querySelector("#buttons div:nth-child(2)");
            const icon = document.getElementById("icon");
        
            commentsButton.addEventListener("click", function () {
                commentsSection.classList.toggle("active");
                questionsSection.classList.remove("active");
            });
        
            questionsButton.addEventListener("click", function () {
                questionsSection.classList.toggle("active");
                commentsSection.classList.remove("active");
            });

            let open = "open"
            icon.addEventListener("click", function () {
                if(open){
                    commentsSection.classList.toggle("accent");
                }else{
                    commentsSection.classList.remove("accent");
                }
            });
        });
    </script>
</body>
</html>